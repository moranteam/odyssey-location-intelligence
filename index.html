<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Odyssey AI | Location Intelligence v4.0 - 6 Property Tour</title>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Helvetica Neue', sans-serif;
            background: #f5f5f7;
            color: #1d1d1f;
            overflow: hidden;
        }

        .container {
            display: flex;
            height: 100vh;
        }

        /* MAP CONTAINER */
        .map-container {
            flex: 1;
            position: relative;
        }

        #map {
            width: 100%;
            height: 100%;
        }

        /* CONTROL PANEL */
        .control-panel {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 400px;
            max-height: calc(100vh - 40px);
            background: rgba(255, 255, 255, 0.98);
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.15);
            backdrop-filter: blur(10px);
            overflow-y: auto;
            z-index: 1000;
        }

        .panel-header {
            background: linear-gradient(135deg, #0071e3 0%, #5856d6 100%);
            color: white;
            padding: 24px;
            border-radius: 16px 16px 0 0;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .panel-header h1 {
            font-size: 22px;
            font-weight: 700;
            margin-bottom: 6px;
        }

        .panel-header p {
            font-size: 13px;
            opacity: 0.95;
        }

        .panel-section {
            padding: 20px;
            border-bottom: 1px solid #e5e5e7;
        }

        .section-title {
            font-size: 13px;
            font-weight: 700;
            color: #86868b;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* COMMUTE SIMULATOR */
        .commute-simulator {
            background: linear-gradient(135deg, #f5f5f7 0%, #e8e8ed 100%);
            padding: 16px;
            border-radius: 12px;
            margin-bottom: 16px;
            border: 2px solid #d2d2d7;
        }

        .simulator-title {
            font-size: 15px;
            font-weight: 700;
            color: #1d1d1f;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .search-box {
            position: relative;
            margin-bottom: 16px;
        }

        .location-dropdown {
            width: 100%;
            padding: 12px 40px 12px 12px;
            border: 2px solid #d2d2d7;
            border-radius: 10px;
            font-size: 14px;
            font-family: 'Inter', sans-serif;
            transition: all 0.2s;
            background: white;
            cursor: pointer;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            background-image: url('data:image/svg+xml;utf8,<svg fill="%2386868b" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M7 10l5 5 5-5z"/></svg>');
            background-repeat: no-repeat;
            background-position: right 10px center;
            background-size: 20px;
        }

        .location-dropdown:focus {
            outline: none;
            border-color: #0071e3;
            box-shadow: 0 0 0 4px rgba(0, 113, 227, 0.1);
        }

        .location-dropdown optgroup {
            font-weight: 600;
            color: #1d1d1f;
            font-size: 13px;
        }

        .location-dropdown option {
            padding: 8px;
            font-size: 14px;
        }

        .search-icon {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 18px;
            color: #86868b;
        }

        .commute-results {
            display: none;
            animation: fadeIn 0.3s ease-in;
        }

        .commute-results.show {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .result-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 12px;
            background: white;
            border-radius: 8px;
            margin-bottom: 8px;
            border: 1px solid #e5e5e7;
        }

        .result-location {
            font-size: 13px;
            font-weight: 600;
            color: #1d1d1f;
        }

        .result-time {
            font-size: 14px;
            font-weight: 700;
            color: #0071e3;
        }

        /* PARKING INFO BADGES */
        .parking-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            margin-top: 4px;
        }
        
        .parking-free {
            background: #e8f5e9;
            color: #2e7d32;
        }
        
        .parking-paid {
            background: #fff3e0;
            color: #e65100;
        }


        .result-transit {
            font-size: 12px;
            color: #86868b;
            margin-top: 8px;
            padding: 8px 12px;
            background: #f5f5f7;
            border-radius: 6px;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #86868b;
            font-size: 13px;
        }

        .loading::after {
            content: '...';
            animation: dots 1.5s steps(4, end) infinite;
        }

        @keyframes dots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60%, 100% { content: '...'; }
        }

        /* TRANSIT TOGGLES */
        .transit-group {
            margin-bottom: 16px;
        }

        .transit-group-title {
            font-size: 12px;
            font-weight: 600;
            color: #86868b;
            margin-bottom: 8px;
        }

        .toggle-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 12px;
            background: #f5f5f7;
            border-radius: 10px;
            margin-bottom: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .toggle-item:hover {
            background: #e8e8ed;
        }

        .toggle-label {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 14px;
            font-weight: 500;
        }

        .toggle-color {
            width: 16px;
            height: 16px;
            border-radius: 4px;
            border: 2px solid white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .toggle-switch {
            width: 44px;
            height: 24px;
            background: #c6c6c8;
            border-radius: 12px;
            position: relative;
            transition: all 0.3s;
        }

        .toggle-switch.active {
            background: #34c759;
        }

        .toggle-switch::after {
            content: '';
            position: absolute;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            top: 2px;
            left: 2px;
            transition: all 0.3s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .toggle-switch.active::after {
            transform: translateX(20px);
        }

        /* ANALYTICS STATS */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }

        .stat-card {
            background: linear-gradient(135deg, #f5f5f7 0%, #e8e8ed 100%);
            padding: 14px;
            border-radius: 10px;
            border: 1px solid #d2d2d7;
        }

        .stat-value {
            font-size: 22px;
            font-weight: 700;
            color: #0071e3;
            margin-bottom: 4px;
        }

        .stat-label {
            font-size: 11px;
            color: #86868b;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* COMMUTE TABLE */
        .commute-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 12px;
        }

        .commute-table thead {
            background: #f5f5f7;
        }

        .commute-table th {
            padding: 10px 8px;
            text-align: left;
            font-weight: 600;
            color: #86868b;
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .commute-table td {
            padding: 10px 8px;
            border-bottom: 1px solid #f5f5f7;
        }

        .commute-table tbody tr:hover {
            background: #f5f5f7;
        }

        .badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 600;
            white-space: nowrap;
        }

        .badge-express {
            background: linear-gradient(135deg, #34c759, #30d158);
            color: white;
        }

        .badge-rail {
            background: linear-gradient(135deg, #007aff, #0071e3);
            color: white;
        }

        .badge-bart {
            background: linear-gradient(135deg, #ff9500, #ffb340);
            color: white;
        }

        .badge-bus {
            background: linear-gradient(135deg, #af52de, #bf5af2);
            color: white;
        }

        .cost-badge {
            background: linear-gradient(135deg, #34c759, #30d158);
            color: white;
        }

        .talent-badge {
            background: linear-gradient(135deg, #c026d3, #e879f9);
            color: white;
        }

        /* ACTION BUTTONS */
        .action-buttons {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .action-button {
            padding: 14px 20px;
            border: none;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
        }

        .button-primary {
            background: linear-gradient(135deg, #0071e3 0%, #5856d6 100%);
            color: white;
        }

        .button-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0, 113, 227, 0.3);
        }

        .button-secondary {
            background: white;
            color: #0071e3;
            border: 2px solid #0071e3;
        }

        .button-secondary:hover {
            background: #0071e3;
            color: white;
        }

        .button-export {
            background: linear-gradient(135deg, #34c759 0%, #30d158 100%);
            color: white;
        }

        .button-export:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(52, 199, 89, 0.3);
        }

        /* LEGEND */
        .legend {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.98);
            padding: 16px;
            border-radius: 12px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.15);
            z-index: 1000;
            min-width: 200px;
        }

        .legend-title {
            font-size: 14px;
            font-weight: 700;
            margin-bottom: 12px;
            color: #1d1d1f;
        }

        .legend-section {
            margin-bottom: 12px;
        }

        .legend-section:last-child {
            margin-bottom: 0;
        }

        .legend-section-title {
            font-size: 11px;
            font-weight: 600;
            color: #86868b;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 6px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 6px;
            font-size: 12px;
        }

        .legend-line {
            width: 24px;
            height: 3px;
            border-radius: 2px;
        }

        .legend-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            border: 2px solid white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .divider {
            height: 1px;
            background: #e5e5e7;
            margin: 12px 0;
        }

        .control-panel::-webkit-scrollbar {
            width: 6px;
        }

        .control-panel::-webkit-scrollbar-track {
            background: #f5f5f7;
        }

        .control-panel::-webkit-scrollbar-thumb {
            background: #c6c6c8;
            border-radius: 3px;
        }

        .control-panel::-webkit-scrollbar-thumb:hover {
            background: #a1a1a6;
        }

        /* Autocomplete styling */
        .pac-container {
            font-family: 'Inter', sans-serif;
            border-radius: 8px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.15);
            margin-top: 4px;
        }
        /* ========================================
           MOBILE RESPONSIVE STYLES
           ======================================== */
        
        /* Tablets and smaller (iPad, landscape phones) */
        @media screen and (max-width: 1024px) {
            .control-panel {
                width: 350px;
            }
            
            .legend {
                display: none; /* Hide legend on tablets to save space */
            }
        }
        
        /* Mobile phones (iPhone, Android) */
        @media screen and (max-width: 768px) {
            body {
                overflow: auto;
            }
            
            .container {
                flex-direction: column;
                height: auto;
                min-height: 100vh;
            }
            
            /* Control panel moves to top */
            .control-panel {
                position: relative;
                top: 0;
                right: 0;
                width: 100%;
                max-height: none;
                margin: 0;
                border-radius: 0 0 16px 16px;
                box-shadow: 0 2px 12px rgba(0,0,0,0.1);
            }
            
            /* Map takes full width below controls */
            .map-container {
                width: 100%;
                height: 60vh;
                min-height: 400px;
            }
            
            #map {
                width: 100%;
                height: 100%;
            }
            
            /* Adjust panel header */
            .panel-header h1 {
                font-size: 20px;
            }
            
            .panel-header p {
                font-size: 13px;
            }
            
            /* Make stats grid more compact */
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
            }
            
            .stat-value {
                font-size: 24px;
            }
            
            .stat-label {
                font-size: 10px;
            }
            
            /* Larger dropdown for touch */
            .location-dropdown {
                font-size: 16px;
                padding: 14px 40px 14px 14px;
            }
            
            /* Larger toggle buttons */
            .toggle-switch {
                width: 51px;
                height: 31px;
            }
            
            .toggle-item {
                padding: 14px 0;
            }
            
            .toggle-label {
                font-size: 15px;
            }
            
            /* Larger action buttons */
            .button-primary,
            .button-secondary,
            .button-export {
                padding: 16px 20px;
                font-size: 16px;
            }
            
            /* Hide legend completely on mobile */
            .legend {
                display: none;
            }
            
            /* Commute results more readable */
            .result-item {
                padding: 14px;
                font-size: 15px;
            }
            
            .result-time {
                font-size: 20px;
            }
            
            /* Commute table smaller font */
            .commute-table {
                font-size: 11px;
            }
            
            .commute-table th {
                font-size: 9px;
                padding: 6px 2px;
            }
            
            .commute-table td {
                padding: 6px 2px;
            }
        }
        
        /* Small phones (iPhone SE, older models) */
        @media screen and (max-width: 375px) {
            .panel-header h1 {
                font-size: 18px;
            }
            
            .stats-grid {
                gap: 8px;
            }
            
            .stat-value {
                font-size: 20px;
            }
            
            .stat-label {
                font-size: 9px;
            }
            
            .location-dropdown {
                font-size: 15px;
                padding: 12px 35px 12px 12px;
            }
            
            .toggle-label {
                font-size: 14px;
            }
            
            .button-primary,
            .button-secondary,
            .button-export {
                padding: 14px 16px;
                font-size: 15px;
            }
        }
    
        /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê CUSTOM ADDRESS FEATURE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
        
        /* Executive Quick Select Buttons */
        .exec-quick-select {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 16px;
        }

        .exec-btn {
            flex: 1;
            min-width: 110px;
            padding: 10px 12px;
            background: linear-gradient(135deg, #0071e3 0%, #5856d6 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
        }

        .exec-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,113,227,0.3);
        }

        .exec-btn:active {
            transform: translateY(0);
        }

        /* OR Divider */
        .or-divider {
            display: flex;
            align-items: center;
            gap: 12px;
            margin: 16px 0;
            color: #86868b;
            font-size: 12px;
            font-weight: 600;
        }

        .or-divider::before,
        .or-divider::after {
            content: '';
            flex: 1;
            height: 1px;
            background: #e5e5e7;
        }

        /* Custom Address Input */
        .custom-address-input {
            margin-bottom: 16px;
        }

        #custom-address {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e5e5e7;
            border-radius: 10px;
            font-size: 14px;
            font-family: 'Inter', sans-serif;
            transition: all 0.2s;
            background: white;
        }

        #custom-address:focus {
            outline: none;
            border-color: #0071e3;
            box-shadow: 0 0 0 4px rgba(0,113,227,0.1);
        }

        .calculate-btn {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #34c759 0%, #30d158 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            margin-top: 8px;
        }

        .calculate-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(52,199,89,0.3);
        }

        .calculate-btn:disabled {
            background: #e5e5e7;
            color: #86868b;
            cursor: not-allowed;
            transform: none;
        }

        /* Custom Results Display */
        .custom-results {
            display: none;
            margin-top: 16px;
            padding: 16px;
            background: linear-gradient(135deg, #f5f5f7 0%, #e8e8ed 100%);
            border-radius: 12px;
        }

        .custom-results.active {
            display: block;
        }

        .result-destination {
            background: white;
            padding: 14px;
            border-radius: 10px;
            margin-bottom: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }

        .result-destination:last-child {
            margin-bottom: 0;
        }

        .dest-name {
            font-size: 15px;
            font-weight: 700;
            color: #1d1d1f;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .dest-address {
            font-size: 11px;
            color: #86868b;
            margin-bottom: 10px;
        }

        .dest-times {
            display: flex;
            gap: 12px;
            font-size: 13px;
        }

        .time-item {
            flex: 1;
            padding: 8px;
            background: #f5f5f7;
            border-radius: 6px;
            text-align: center;
        }

        .time-label {
            font-size: 10px;
            color: #86868b;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 4px;
        }

        .time-value {
            font-size: 15px;
            font-weight: 700;
            color: #1d1d1f;
        }

        /* Loading Indicator */
        .loading-indicator {
            display: none;
            text-align: center;
            padding: 20px;
            color: #86868b;
        }

        .loading-indicator.active {
            display: block;
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #0071e3;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 12px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

</style>
</head>
<body>
    <div class="container">
        <!-- MAP -->
        <div class="map-container">
            <div id="map"></div>
            
            <!-- LEGEND -->
            <div class="legend">
                <div class="legend-title">üìç Map Legend</div>
                
                <div class="legend-section">
                    <div class="legend-section-title">Transit Lines</div>
                    <div class="legend-item">
                        <div class="legend-line" style="background: #e31837;"></div>
                        <span>Caltrain</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-line" style="background: #ed1c24; border: 2px dashed rgba(237,28,36,0.5);"></div>
                        <span>BART Red</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-line" style="background: #ffcd26; border: 2px dashed rgba(255,205,38,0.5);"></div>
                        <span>BART Yellow</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-line" style="background: #00a84d; border: 2px dashed rgba(0,168,77,0.5);"></div>
                        <span>BART Green</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-line" style="background: #00adef; border: 2px dashed rgba(0,173,239,0.5);"></div>
                        <span>BART Blue</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-line" style="background: #ff9933; border: 2px dashed rgba(255,153,51,0.5);"></div>
                        <span>BART Orange</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-line" style="background: #0066cc;"></div>
                        <span>VTA Light Rail</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-line" style="background: #af52de; border: 2px dashed rgba(175,82,222,0.5);"></div>
                        <span>Dumbarton Express</span>
                    </div>
                </div>

                <div class="divider"></div>

                <div class="legend-section">
                    <div class="legend-section-title">Target Locations</div>
                    <div class="legend-item">
                        <div class="legend-dot" style="background: #34c759;"></div>
                        <span>Redwood City</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-dot" style="background: #0071e3;"></div>
                        <span>Palo Alto</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-dot" style="background: #5856d6;"></div>
                        <span>Menlo Park</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- CONTROL PANEL -->
        <div class="control-panel">
            <div class="panel-header">
                <h1>üéØ Odyssey AI Location Intelligence</h1>
                <p>Bay Area Transit & Talent Analysis</p>
            </div>

            <!-- COMMUTE SIMULATOR -->
            <div class="panel-section">
                <div class="commute-simulator">
                    <div class="simulator-title">üè† Calculate Your Commute</div>
                    <div class="search-box">
                        <select id="location-select" class="location-dropdown">
                            <option value="">Select your home location...</option>
                            <optgroup label="San Francisco">
                                <option value="San Francisco (Financial District)">Financial District</option>
                                <option value="San Francisco (SoMa)">SoMa</option>
                                <option value="San Francisco (Mission District)">Mission District</option>
                            </optgroup>
                            <optgroup label="East Bay">
                                <option value="Oakland">Oakland</option>
                                <option value="Berkeley">Berkeley</option>
                                <option value="Walnut Creek">Walnut Creek</option>
                                <option value="Concord">Concord</option>
                                <option value="Danville">Danville</option>
                                <option value="Pleasanton">Pleasanton</option>
                                <option value="Fremont">Fremont</option>
                                <option value="Hayward">Hayward</option>
                            </optgroup>
                            <optgroup label="Peninsula">
                                <option value="Daly City">Daly City</option>
                                <option value="South San Francisco">South San Francisco</option>
                                <option value="San Bruno">San Bruno</option>
                                <option value="Millbrae">Millbrae</option>
                                <option value="Burlingame">Burlingame</option>
                                <option value="San Mateo">San Mateo</option>
                                <option value="Belmont">Belmont</option>
                                <option value="San Carlos">San Carlos</option>
                                <option value="Redwood City">Redwood City</option>
                                <option value="Menlo Park">Menlo Park</option>
                                <option value="Palo Alto">Palo Alto</option>
                            </optgroup>
                            <optgroup label="South Bay">
                                <option value="Mountain View">Mountain View</option>
                                <option value="Sunnyvale">Sunnyvale</option>
                                <option value="Santa Clara">Santa Clara</option>
                                <option value="San Jose">San Jose</option>
                                <option value="Cupertino">Cupertino</option>
                                <option value="Milpitas">Milpitas</option>
                            </optgroup>
                        
                        </select>
                        
                        <!-- Executive Quick-Select Buttons -->
                        <div class="exec-quick-select">
                            <button class="exec-btn" data-exec="Pacific Heights">üìç Pacific Heights</button>
                            <button class="exec-btn" data-exec="Oakland">üìç Oakland</button>
                            <button class="exec-btn" data-exec="Oliver (San Jose)">üìç Oliver (SJ)</button>
                        </div>

                        <div class="or-divider">OR ENTER CUSTOM ADDRESS</div>

                        <div class="custom-address-input">
                            <input 
                                type="text" 
                                id="custom-address" 
                                placeholder="Enter your home address..."
                                autocomplete="off"
                            >
                            <button id="calculate-commute" class="calculate-btn">üöó Calculate My Commute Times</button>
                        </div>

                        <div id="loading-indicator" class="loading-indicator">
                            <div class="spinner"></div>
                            <div>Calculating commute times...</div>
                        </div>

                        <div id="custom-results" class="custom-results"></div>

                        <span class="search-icon">üìç</span>
                    </div>
                    
                    <div id="commute-results" class="commute-results">
                        <div class="result-item">
                            <span class="result-location">üéØ To Redwood City</span>
                            <span class="result-time" id="time-rwc">--</span>
                        </div>
                        <div class="result-item">
                            <span class="result-location">üìç To Palo Alto</span>
                            <span class="result-time" id="time-pa">--</span>
                        </div>
                        <div class="result-item">
                            <span class="result-location">üè¢ To Menlo Park</span>
                            <span class="result-time" id="time-mp">--</span>
                        </div>
                        <div class="result-transit" id="transit-recommendation">
                            üöÜ Best Transit Option: Calculating...
                        </div>
                    </div>
                    
                    <div id="loading" class="loading" style="display: none;">
                        Calculating your commute times
                    </div>
                </div>
            </div>

            <!-- LIVE ANALYTICS -->
            <div class="panel-section">
                <div class="section-title">üìä Live Analytics</div>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value">95k+</div>
                        <div class="stat-label">AI Talent Pool</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">35 min</div>
                        <div class="stat-label">SF Express</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">$3,840</div>
                        <div class="stat-label">Avg Annual Savings</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">850</div>
                        <div class="stat-label">Parking Spaces</div>
                    </div>
                </div>
            </div>

            <!-- TRANSIT ROUTES -->
            <div class="panel-section">
                <div class="section-title">üöÜ Transit Routes</div>
                
                <div class="transit-group">
                    <div class="transit-group-title">Peninsula Rail</div>
                    <div class="toggle-item" data-layer="caltrain">
                        <div class="toggle-label">
                            <div class="toggle-color" style="background: #e31837;"></div>
                            Caltrain
                        </div>
                        <div class="toggle-switch active"></div>
                    </div>
                </div>

                <div class="transit-group">
                    <div class="transit-group-title">BART Lines</div>
                    <div class="toggle-item" data-layer="bart-red">
                        <div class="toggle-label">
                            <div class="toggle-color" style="background: #ed1c24;"></div>
                            Red Line
                        </div>
                        <div class="toggle-switch active"></div>
                    </div>
                    <div class="toggle-item" data-layer="bart-yellow">
                        <div class="toggle-label">
                            <div class="toggle-color" style="background: #ffcd26;"></div>
                            Yellow Line
                        </div>
                        <div class="toggle-switch active"></div>
                    </div>
                    <div class="toggle-item" data-layer="bart-green">
                        <div class="toggle-label">
                            <div class="toggle-color" style="background: #00a84d;"></div>
                            Green Line
                        </div>
                        <div class="toggle-switch active"></div>
                    </div>
                    <div class="toggle-item" data-layer="bart-blue">
                        <div class="toggle-label">
                            <div class="toggle-color" style="background: #00adef;"></div>
                            Blue Line
                        </div>
                        <div class="toggle-switch active"></div>
                    </div>
                    <div class="toggle-item" data-layer="bart-orange">
                        <div class="toggle-label">
                            <div class="toggle-color" style="background: #ff9933;"></div>
                            Orange Line
                        </div>
                        <div class="toggle-switch active"></div>
                    </div>
                </div>

                <div class="transit-group">
                    <div class="transit-group-title">Other Transit</div>
                    <div class="toggle-item" data-layer="vta">
                        <div class="toggle-label">
                            <div class="toggle-color" style="background: #0066cc;"></div>
                            VTA Light Rail
                        </div>
                        <div class="toggle-switch active"></div>
                    </div>
                    <div class="toggle-item" data-layer="dumbarton">
                        <div class="toggle-label">
                            <div class="toggle-color" style="background: #af52de;"></div>
                            Dumbarton Express
                        </div>
                        <div class="toggle-switch active"></div>
                    </div>
                </div>
            </div>

            <!-- DATA LAYERS -->
            <div class="panel-section">
                <div class="section-title">üé® Data Layers</div>
                
                <div class="toggle-item" data-layer="heatmap">
                    <div class="toggle-label">
                        AI Talent Heat Map
                    </div>
                    <div class="toggle-switch active"></div>
                </div>
                
                <div class="toggle-item" data-layer="parking">
                    <div class="toggle-label">
                        Parking Locations
                    </div>
                    <div class="toggle-switch"></div>
                </div>
                
                <div class="toggle-item" data-layer="companies">
                    <div class="toggle-label">
                        Tech Companies
                    </div>
                    <div class="toggle-switch"></div>
                </div>
            </div>

            <!-- COMMUTE TIMES: PENINSULA -->
            <div class="panel-section">
                <div class="section-title">‚è±Ô∏è Peninsula Commutes (Caltrain)</div>
                
                <table class="commute-table">
                    <thead>
                        <tr>
                            <th>Origin</th>
                            <th>To RWC</th>
                            <th>To PA</th>
                            <th>$/mo</th>
                            <th>Talent</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>SF 4th & King</strong></td>
                            <td><span class="badge badge-express">35m</span></td>
                            <td><span class="badge badge-rail">49m</span></td>
                            <td><span class="badge cost-badge">$273</span></td>
                            <td><span class="badge talent-badge" style="background: #c026d3;">32k</span></td>
                        </tr>
                        <tr>
                            <td><strong>SF 22nd St</strong></td>
                            <td><span class="badge badge-express">33m</span></td>
                            <td><span class="badge badge-rail">47m</span></td>
                            <td><span class="badge cost-badge">$273</span></td>
                            <td><span class="badge talent-badge" style="background: #a855f7;">8k</span></td>
                        </tr>
                        <tr>
                            <td><strong>Millbrae</strong></td>
                            <td><span class="badge badge-express">23m</span></td>
                            <td><span class="badge badge-rail">37m</span></td>
                            <td><span class="badge cost-badge">$208</span></td>
                            <td><span class="badge talent-badge" style="background: #9333ea;">5k</span></td>
                        </tr>
                        <tr>
                            <td><strong>San Mateo</strong></td>
                            <td><span class="badge badge-express">16m</span></td>
                            <td><span class="badge badge-rail">30m</span></td>
                            <td><span class="badge cost-badge">$163</span></td>
                            <td><span class="badge talent-badge" style="background: #9333ea;">4k</span></td>
                        </tr>
                        <tr>
                            <td><strong>Mountain View</strong></td>
                            <td><span class="badge badge-rail">19m</span></td>
                            <td><span class="badge badge-rail">10m</span></td>
                            <td><span class="badge cost-badge">$118</span></td>
                            <td><span class="badge talent-badge" style="background: #c026d3;">15k</span></td>
                        </tr>
                        <tr>
                            <td><strong>Sunnyvale</strong></td>
                            <td><span class="badge badge-rail">23m</span></td>
                            <td><span class="badge badge-rail">14m</span></td>
                            <td><span class="badge cost-badge">$118</span></td>
                            <td><span class="badge talent-badge" style="background: #a855f7;">12k</span></td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- COMMUTE TIMES: EAST BAY -->
            <div class="panel-section">
                <div class="section-title">‚è±Ô∏è East Bay Commutes (BART/Bus)</div>
                
                <table class="commute-table">
                    <thead>
                        <tr>
                            <th>Origin</th>
                            <th>Route</th>
                            <th>Time</th>
                            <th>$/mo</th>
                            <th>Talent</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Oakland DT</strong></td>
                            <td><span class="badge badge-bart">BART</span> + <span class="badge badge-rail">Rail</span></td>
                            <td>95m</td>
                            <td><span class="badge cost-badge">$343</span></td>
                            <td><span class="badge talent-badge" style="background: #c026d3;">18k</span></td>
                        </tr>
                        <tr>
                            <td><strong>Fremont</strong></td>
                            <td><span class="badge badge-bus">Dumbarton</span></td>
                            <td>75m</td>
                            <td><span class="badge cost-badge">$298</span></td>
                            <td><span class="badge talent-badge" style="background: #9333ea;">6k</span></td>
                        </tr>
                        <tr>
                            <td><strong>Union City</strong></td>
                            <td><span class="badge badge-bus">Dumbarton</span></td>
                            <td>80m</td>
                            <td><span class="badge cost-badge">$298</span></td>
                            <td><span class="badge talent-badge" style="background: #9333ea;">4k</span></td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- COMMUTE TIMES: SOUTH BAY -->
            <div class="panel-section">
                <div class="section-title">‚è±Ô∏è South Bay Commutes (Caltrain+VTA)</div>
                
                <table class="commute-table">
                    <thead>
                        <tr>
                            <th>Origin</th>
                            <th>Route</th>
                            <th>Time</th>
                            <th>$/mo</th>
                            <th>Talent</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>San Jose Diridon</strong></td>
                            <td><span class="badge badge-rail">Caltrain</span></td>
                            <td>26m</td>
                            <td><span class="badge cost-badge">$163</span></td>
                            <td><span class="badge talent-badge" style="background: #c026d3;">24k</span></td>
                        </tr>
                        <tr>
                            <td><strong>Santa Clara</strong></td>
                            <td><span class="badge badge-rail">Caltrain</span></td>
                            <td>20m</td>
                            <td><span class="badge cost-badge">$118</span></td>
                            <td><span class="badge talent-badge" style="background: #a855f7;">8k</span></td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- ACTION BUTTONS -->
            <div class="panel-section">
                <div class="section-title">üõ†Ô∏è Analysis Tools</div>
                <div class="action-buttons">
                    <button class="action-button button-primary" onclick="openCalculator()">
                        üí∞ Cost Calculator
                    </button>
                    <button class="action-button button-secondary" onclick="openProfiler()">
                        üë§ Profile Analyzer
                    </button>
                    <button class="action-button button-export" onclick="exportData()">
                        üì• Export Data (CSV)
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet.heat@0.2.0/dist/leaflet-heat.js"></script>
    
    <script>
        console.log('üöÄ Initializing Odyssey AI Map with Dropdown Commute Calculator...');
        
        // Pre-calculated commute data
        const commuteData = {
            'San Francisco (Financial District)': { rwc: { drive: 38, cost: 273, line: 'Caltrain from 4th & King' }, pa: { drive: 46, cost: 273, line: 'Caltrain from 4th & King' }, mp: { drive: 43, cost: 273, line: 'Caltrain from 4th & King' } },
            'San Francisco (SoMa)': { rwc: { drive: 36, cost: 273, line: 'Caltrain from 4th & King' }, pa: { drive: 44, cost: 273, line: 'Caltrain from 4th & King' }, mp: { drive: 41, cost: 273, line: 'Caltrain from 4th & King' } },
            'San Francisco (Mission District)': { rwc: { drive: 35, cost: 273, line: 'Caltrain from 22nd St' }, pa: { drive: 43, cost: 273, line: 'Caltrain from 22nd St' }, mp: { drive: 40, cost: 273, line: 'Caltrain from 22nd St' } },
            'Oakland': { rwc: { drive: 42, cost: 208, line: 'BART to Millbrae ‚Üí Caltrain' }, pa: { drive: 50, cost: 208, line: 'BART to Millbrae ‚Üí Caltrain' }, mp: { drive: 47, cost: 208, line: 'BART to Millbrae ‚Üí Caltrain' } },
            'Berkeley': { rwc: { drive: 45, cost: 208, line: 'BART to Millbrae ‚Üí Caltrain' }, pa: { drive: 53, cost: 208, line: 'BART to Millbrae ‚Üí Caltrain' }, mp: { drive: 50, cost: 208, line: 'BART to Millbrae ‚Üí Caltrain' } },
            'Walnut Creek': { rwc: { drive: 52, cost: 208, line: 'BART to Millbrae ‚Üí Caltrain' }, pa: { drive: 60, cost: 208, line: 'BART to Millbrae ‚Üí Caltrain' }, mp: { drive: 57, cost: 208, line: 'BART to Millbrae ‚Üí Caltrain' } },
            'Concord': { rwc: { drive: 58, cost: 208, line: 'BART to Millbrae ‚Üí Caltrain' }, pa: { drive: 66, cost: 208, line: 'BART to Millbrae ‚Üí Caltrain' }, mp: { drive: 63, cost: 208, line: 'BART to Millbrae ‚Üí Caltrain' } },
            'Danville': { rwc: { drive: 45, cost: 208, line: 'BART from Dublin/Pleasanton ‚Üí Caltrain' }, pa: { drive: 53, cost: 208, line: 'BART from Dublin/Pleasanton ‚Üí Caltrain' }, mp: { drive: 50, cost: 208, line: 'BART from Dublin/Pleasanton ‚Üí Caltrain' } },
            'Pleasanton': { rwc: { drive: 40, cost: 208, line: 'BART from Dublin/Pleasanton ‚Üí Caltrain' }, pa: { drive: 48, cost: 208, line: 'BART from Dublin/Pleasanton ‚Üí Caltrain' }, mp: { drive: 45, cost: 208, line: 'BART from Dublin/Pleasanton ‚Üí Caltrain' } },
            'Fremont': { rwc: { drive: 32, cost: 163, line: 'Dumbarton Express or BART ‚Üí Caltrain' }, pa: { drive: 40, cost: 163, line: 'Dumbarton Express' }, mp: { drive: 37, cost: 163, line: 'Dumbarton Express' } },
            'Hayward': { rwc: { drive: 35, cost: 163, line: 'BART to Millbrae ‚Üí Caltrain' }, pa: { drive: 43, cost: 163, line: 'BART to Millbrae ‚Üí Caltrain' }, mp: { drive: 40, cost: 163, line: 'BART to Millbrae ‚Üí Caltrain' } },
            'Daly City': { rwc: { drive: 28, cost: 208, line: 'BART to Millbrae ‚Üí Caltrain' }, pa: { drive: 36, cost: 208, line: 'BART to Millbrae ‚Üí Caltrain' }, mp: { drive: 33, cost: 208, line: 'BART to Millbrae ‚Üí Caltrain' } },
            'South San Francisco': { rwc: { drive: 22, cost: 163, line: 'Caltrain from South SF' }, pa: { drive: 30, cost: 163, line: 'Caltrain from South SF' }, mp: { drive: 27, cost: 163, line: 'Caltrain from South SF' } },
            'San Bruno': { rwc: { drive: 20, cost: 163, line: 'Caltrain from San Bruno' }, pa: { drive: 28, cost: 163, line: 'Caltrain from San Bruno' }, mp: { drive: 25, cost: 163, line: 'Caltrain from San Bruno' } },
            'Millbrae': { rwc: { drive: 18, cost: 163, line: 'Caltrain from Millbrae' }, pa: { drive: 26, cost: 163, line: 'Caltrain from Millbrae' }, mp: { drive: 23, cost: 163, line: 'Caltrain from Millbrae' } },
            'Burlingame': { rwc: { drive: 15, cost: 163, line: 'Caltrain from Burlingame' }, pa: { drive: 23, cost: 163, line: 'Caltrain from Burlingame' }, mp: { drive: 20, cost: 163, line: 'Caltrain from Burlingame' } },
            'San Mateo': { rwc: { drive: 12, cost: 163, line: 'Caltrain from San Mateo' }, pa: { drive: 20, cost: 163, line: 'Caltrain from San Mateo' }, mp: { drive: 17, cost: 163, line: 'Caltrain from San Mateo' } },
            'Belmont': { rwc: { drive: 10, cost: 118, line: 'Caltrain from Belmont' }, pa: { drive: 18, cost: 118, line: 'Caltrain from Belmont' }, mp: { drive: 15, cost: 118, line: 'Caltrain from Belmont' } },
            'San Carlos': { rwc: { drive: 8, cost: 118, line: 'Caltrain from San Carlos' }, pa: { drive: 16, cost: 118, line: 'Caltrain from San Carlos' }, mp: { drive: 13, cost: 118, line: 'Caltrain from San Carlos' } },
            'Redwood City': { rwc: { drive: 5, cost: 0, line: 'Walk or bike to office' }, pa: { drive: 13, cost: 118, line: 'Caltrain from Redwood City' }, mp: { drive: 10, cost: 118, line: 'Caltrain from Redwood City' } },
            'Menlo Park': { rwc: { drive: 8, cost: 118, line: 'Caltrain from Menlo Park' }, pa: { drive: 5, cost: 0, line: 'Walk or bike to office' }, mp: { drive: 3, cost: 0, line: 'Walk or bike to office' } },
            'Palo Alto': { rwc: { drive: 11, cost: 118, line: 'Caltrain from Palo Alto' }, pa: { drive: 5, cost: 0, line: 'Walk or bike to office' }, mp: { drive: 6, cost: 118, line: 'Caltrain from Palo Alto' } },
            'Mountain View': { rwc: { drive: 16, cost: 118, line: 'Caltrain from Mountain View' }, pa: { drive: 10, cost: 118, line: 'Caltrain from Mountain View' }, mp: { drive: 12, cost: 118, line: 'Caltrain from Mountain View' } },
            'Sunnyvale': { rwc: { drive: 20, cost: 118, line: 'Caltrain from Sunnyvale' }, pa: { drive: 14, cost: 118, line: 'Caltrain from Sunnyvale' }, mp: { drive: 16, cost: 118, line: 'Caltrain from Sunnyvale' } },
            'Santa Clara': { rwc: { drive: 24, cost: 163, line: 'Caltrain from Santa Clara' }, pa: { drive: 18, cost: 163, line: 'Caltrain from Santa Clara' }, mp: { drive: 20, cost: 163, line: 'Caltrain from Santa Clara' } },
            'San Jose': { rwc: { drive: 30, cost: 163, line: 'Caltrain from San Jose' }, pa: { drive: 24, cost: 163, line: 'Caltrain from San Jose' }, mp: { drive: 26, cost: 163, line: 'Caltrain from San Jose' } },
            'Cupertino': { rwc: { drive: 22, cost: 163, line: 'VTA Light Rail ‚Üí Caltrain' }, pa: { drive: 16, cost: 163, line: 'Drive or carpool' }, mp: { drive: 18, cost: 163, line: 'Drive or carpool' } },
            'Milpitas': { rwc: { drive: 28, cost: 163, line: 'VTA ‚Üí Caltrain' }, pa: { drive: 22, cost: 163, line: 'VTA ‚Üí Caltrain' }, mp: { drive: 24, cost: 163, line: 'VTA ‚Üí Caltrain' } }
        };
        
        // Initialize map
        const map = L.map('map').setView([37.52, -122.27], 12);
        console.log('‚úÖ Map initialized');

        // Add CartoDB Positron tile layer
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '¬© OpenStreetMap contributors',
            maxZoom: 19
        }).addTo(map);
        console.log('‚úÖ Base tiles loaded');

        // Handle location selection
        const locationSelect = document.getElementById('location-select');
        const resultsDiv = document.getElementById('commute-results');
        const loadingDiv = document.getElementById('loading');
        
        locationSelect.addEventListener('change', function() {
            const selectedLocation = this.value;
            
            if (!selectedLocation || !commuteData[selectedLocation]) {
                resultsDiv.classList.remove('show');
                return;
            }
            
            loadingDiv.style.display = 'block';
            resultsDiv.classList.remove('show');
            
            setTimeout(() => {
                const data = commuteData[selectedLocation];
                
                document.getElementById('time-rwc').textContent = `${data.rwc.drive} mins`;
                document.getElementById('time-pa').textContent = `${data.pa.drive} mins`;
                document.getElementById('time-mp').textContent = `${data.mp.drive} mins`;
                
                const times = [
                    { name: 'Redwood City', time: data.rwc.drive, data: data.rwc },
                    { name: 'Palo Alto', time: data.pa.drive, data: data.pa },
                    { name: 'Menlo Park', time: data.mp.drive, data: data.mp }
                ];
                times.sort((a, b) => a.time - b.time);
                const best = times[0];
                
                let transitRec = `üöÜ ${best.data.line} | $${best.data.cost}/mo`;
                if (best.time < 15) transitRec += ' | üéØ Excellent!';
                else if (best.time < 30) transitRec += ' | ‚úÖ Great option';
                else if (best.time < 45) transitRec += ' | üëç Good commute';
                else transitRec += ' | ‚ö†Ô∏è Consider flexible schedule';
                
                document.getElementById('transit-recommendation').textContent = transitRec;
                loadingDiv.style.display = 'none';
                resultsDiv.classList.add('show');
                console.log(`‚úÖ Commute times displayed for ${selectedLocation}`);
            }, 300);
        });

        // Layer storage
        const layers = {
            caltrain: L.layerGroup(),
            'bart-red': L.layerGroup(),
            'bart-yellow': L.layerGroup(),
            'bart-green': L.layerGroup(),
            'bart-blue': L.layerGroup(),
            'bart-orange': L.layerGroup(),
            vta: L.layerGroup(),
            dumbarton: L.layerGroup(),
            heatmap: null,
            parking: L.layerGroup(),
            companies: L.layerGroup()
        };

        // Add all transit layer groups to map initially
        Object.keys(layers).forEach(key => {
            if (key !== 'heatmap' && key !== 'parking' && key !== 'companies') {
                layers[key].addTo(map);
            }
        });
        console.log('‚úÖ Layer groups initialized');

        // Caltrain stations
        const caltrainStations = [
            [37.7765, -122.3944], // SF 4th & King
            [37.7577, -122.4117], // 22nd St
            [37.6036, -122.3869], // Millbrae
            [37.5688, -122.3247], // Burlingame
            [37.5299, -122.2960], // San Mateo
            [37.4863, -122.2325], // Redwood City
            [37.4544, -122.1820], // Menlo Park
            [37.4430, -122.1649], // Palo Alto
            [37.3943, -122.0764], // Mountain View
            [37.3780, -122.0310], // Sunnyvale
            [37.3525, -121.9939], // Santa Clara
            [37.3297, -121.9026]  // San Jose Diridon
        ];

        // Draw Caltrain line
        const caltrainPolyline = L.polyline(caltrainStations, {
            color: '#e31837',
            weight: 4,
            opacity: 0.7
        });
        caltrainPolyline.addTo(layers.caltrain);

        // Add Caltrain station markers
        caltrainStations.forEach(coord => {
            L.circleMarker(coord, {
                radius: 5,
                fillColor: '#e31837',
                color: 'white',
                weight: 2,
                opacity: 1,
                fillOpacity: 0.9
            }).addTo(layers.caltrain);
        });
        console.log('‚úÖ Caltrain line added (12 stations)');

        // BART Red Line
        const bartRedLine = [
            [37.9373, -122.3534], [37.8732, -122.2670], [37.8054, -122.2719],
            [37.7949, -122.2654], [37.7929, -122.2727], [37.7747, -122.4184],
            [37.7894, -122.4011], [37.7844, -122.4078], [37.7796, -122.4141],
            [37.7648, -122.4194], [37.7521, -122.4181], [37.7329, -122.4012],
            [37.7216, -122.4476], [37.6871, -122.4695], [37.6699, -122.4678],
            [37.6528, -122.4690], [37.6366, -122.4160], [37.6036, -122.3869]
        ];
        L.polyline(bartRedLine, {
            color: '#ed1c24',
            weight: 4,
            opacity: 0.7,
            dashArray: '10, 5'
        }).addTo(layers['bart-red']);

        // BART Yellow Line
        const bartYellowLine = [
            [37.9952, -121.7807], [37.9732, -121.9000], [37.9459, -121.9407],
            [37.9287, -122.0170], [37.9259, -122.0313], [37.9076, -122.0565],
            [37.8732, -122.2670], [37.8054, -122.2719], [37.7747, -122.4184],
            [37.6036, -122.3869]
        ];
        L.polyline(bartYellowLine, {
            color: '#ffcd26',
            weight: 4,
            opacity: 0.7,
            dashArray: '10, 5'
        }).addTo(layers['bart-yellow']);

        // BART Green Line
        const bartGreenLine = [
            [37.3690, -121.8753], [37.4097, -121.9389], [37.5575, -121.9765],
            [37.5994, -122.0172], [37.6970, -122.1213], [37.7216, -122.4476]
        ];
        L.polyline(bartGreenLine, {
            color: '#00a84d',
            weight: 4,
            opacity: 0.7,
            dashArray: '10, 5'
        }).addTo(layers['bart-green']);

        // BART Blue Line
        const bartBlueLine = [
            [37.7216, -122.4476], [37.7136, -122.4425], [37.7329, -122.4012],
            [37.6970, -122.1213], [37.6844, -122.0997], [37.6525, -122.0567],
            [37.7017, -121.9001]
        ];
        L.polyline(bartBlueLine, {
            color: '#00adef',
            weight: 4,
            opacity: 0.7,
            dashArray: '10, 5'
        }).addTo(layers['bart-blue']);

        // BART Orange Line
        const bartOrangeLine = [
            [37.9373, -122.3534], [37.8732, -122.2670], [37.8054, -122.2719],
            [37.6970, -122.1213], [37.5575, -121.9765], [37.3690, -121.8753]
        ];
        L.polyline(bartOrangeLine, {
            color: '#ff9933',
            weight: 4,
            opacity: 0.7,
            dashArray: '10, 5'
        }).addTo(layers['bart-orange']);

        // VTA Light Rail
        const vtaStations = [
            [37.3525, -121.9939], [37.3780, -122.0310], [37.3943, -122.0764]
        ];
        L.polyline(vtaStations, {
            color: '#0066cc',
            weight: 4,
            opacity: 0.7
        }).addTo(layers.vta);

        // Dumbarton Express
        const dumbartonRoute = [
            [37.5994, -122.0172], [37.5575, -121.9765],
            [37.5046, -122.0825], [37.4544, -122.1820]
        ];
        L.polyline(dumbartonRoute, {
            color: '#af52de',
            weight: 4,
            opacity: 0.7,
            dashArray: '5, 5'
        }).addTo(layers.dumbarton);

        console.log('‚úÖ All BART lines, VTA, and Dumbarton added');

        // Target location markers - 6 Properties
        const targets = [
            { name: '201 Baldwin', coords: [37.5636, -122.3228], color: '#0ea5e9', num: 1 },
            { name: '2 E 3rd Ave', coords: [37.5636, -122.3248], color: '#0ea5e9', num: 2 },
            { name: '2317 Broadway', coords: [37.4863, -122.2325], color: '#ef4444', num: 3 },
            { name: '900 Veterans', coords: [37.4920, -122.2280], color: '#ef4444', num: 4 },
            { name: '181 2nd Ave', coords: [37.5645, -122.3235], color: '#0ea5e9', num: 5 },
            { name: '1 Franklin', coords: [37.5500, -122.3000], color: '#0ea5e9', num: 6 }
        ];

        targets.forEach(target => {
            const icon = L.divIcon({
                className: 'pulse-marker',
                html: `<div style="background: ${target.color}; width: 32px; height: 32px; border-radius: 50%; border: 3px solid white; box-shadow: 0 2px 8px rgba(0,0,0,0.3); display: flex; align-items: center; justify-content: center; color: white; font-weight: 700; font-size: 14px;">${target.num}</div>`,
                iconSize: [32, 32]
            });
            L.marker(target.coords, { icon })
                .bindPopup(`<b>Property ${target.num}: ${target.name}</b><br>${OFFICE_LOCATIONS['Property' + target.num].address}<br>${OFFICE_LOCATIONS['Property' + target.num].parking ? 'üÖøÔ∏è ' + OFFICE_LOCATIONS['Property' + target.num].parking : ''}`)
                .addTo(map);
        });
        console.log('‚úÖ Target markers added');

        // Heat map data
        const heatData = [
            [37.7765, -122.3944, 1.0], [37.7844, -122.4078, 0.9],
            [37.4863, -122.2325, 0.7], [37.4430, -122.1649, 0.8],
            [37.4544, -122.1820, 0.6], [37.3943, -122.0764, 0.75],
            [37.3780, -122.0310, 0.6], [37.3297, -121.9026, 0.85],
            [37.8054, -122.2719, 0.5], [37.5575, -121.9765, 0.4]
        ];

        layers.heatmap = L.heatLayer(heatData, {
            radius: 35,
            blur: 25,
            maxZoom: 13,
            gradient: {
                0.0: '#00ff00',
                0.3: '#ffff00',
                0.6: '#ffa500',
                1.0: '#ff0000'
            }
        }).addTo(map);
        console.log('‚úÖ Heat map added');

        // Parking locations
        const parkingLocations = [
            { name: 'Marshall Square', coords: [37.4847, -122.2264], rate: 125, spaces: 450 },
            { name: 'Downtown RWC', coords: [37.4863, -122.2325], rate: 125, spaces: 400 },
            { name: 'High/Alma South', coords: [37.4430, -122.1610], rate: 275, spaces: 180 },
            { name: 'Civic Center', coords: [37.4445, -122.1598], rate: 275, spaces: 140 },
            { name: 'Downtown Menlo', coords: [37.4544, -122.1820], rate: 180, spaces: 220 },
            { name: 'Menlo Center', coords: [37.4520, -122.1780], rate: 180, spaces: 200 },
            { name: 'SoMa Garage 5th', coords: [37.7810, -122.4068], rate: 375, spaces: 350 },
            { name: 'SoMa Hub', coords: [37.7765, -122.3970], rate: 375, spaces: 500 }
        ];

        parkingLocations.forEach(p => {
            const color = p.rate <= 150 ? '#34c759' : p.rate <= 200 ? '#ff9500' : '#ff3b30';
            L.circleMarker(p.coords, {
                radius: 8,
                fillColor: color,
                color: 'white',
                weight: 2,
                opacity: 1,
                fillOpacity: 0.8
            }).bindPopup(`
                <strong>${p.name}</strong><br>
                Rate: $${p.rate}/month<br>
                Spaces: ${p.spaces}
            `).addTo(layers.parking);
        });

        // Tech companies
        const companies = [
            { name: 'Box HQ', coords: [37.4863, -122.2325], employees: 2000 },
            { name: 'EA', coords: [37.4880, -122.2350], employees: 3500 },
            { name: 'Oracle', coords: [37.5303, -122.2656], employees: 5000 },
            { name: 'VMware', coords: [37.4430, -122.1649], employees: 4000 },
            { name: 'Tesla', coords: [37.3946, -122.1481], employees: 6000 },
            { name: 'Palantir', coords: [37.4430, -122.1600], employees: 1500 },
            { name: 'Meta HQ', coords: [37.4847, -122.1477], employees: 18000 },
            { name: 'Meta Campus', coords: [37.4520, -122.1800], employees: 12000 },
            { name: 'Google', coords: [37.4220, -122.0841], employees: 24000 },
            { name: 'LinkedIn', coords: [37.4241, -122.0775], employees: 8000 },
            { name: 'Apple Park', coords: [37.3349, -122.0090], employees: 25000 },
            { name: 'Nvidia', coords: [37.3708, -121.9644], employees: 7000 }
        ];

        companies.forEach(c => {
            L.circleMarker(c.coords, {
                radius: 6,
                fillColor: '#1d1d1f',
                color: 'white',
                weight: 2,
                opacity: 1,
                fillOpacity: 0.9
            }).bindPopup(`
                <strong>${c.name}</strong><br>
                Employees: ${c.employees.toLocaleString()}
            `).addTo(layers.companies);
        });
        console.log('‚úÖ Parking and company markers added');

        // Toggle functionality
        document.querySelectorAll('.toggle-item').forEach(item => {
            item.addEventListener('click', () => {
                const layerName = item.dataset.layer;
                const toggle = item.querySelector('.toggle-switch');
                const isActive = toggle.classList.contains('active');

                if (isActive) {
                    toggle.classList.remove('active');
                    if (layers[layerName]) {
                        map.removeLayer(layers[layerName]);
                    }
                } else {
                    toggle.classList.add('active');
                    if (layers[layerName]) {
                        map.addLayer(layers[layerName]);
                    }
                }
            });
        });
        console.log('‚úÖ Toggles configured');

        // Action button functions
        function openCalculator() {
            window.open('Odyssey_AI_Complete_Commute_Analysis.html', '_blank');
        }

        function openProfiler() {
            window.open('Odyssey_AI_Employee_Profile_Analyzer.html', '_blank');
        }

        function exportData() {
            const csv = [
                ['Odyssey AI - Location Analysis Export'],
                ['Generated: ' + new Date().toLocaleString()],
                [''],
                ['Target Locations'],
                ['Location', 'Parking Rate/mo'],
                ['Redwood City', '$125'],
                ['Menlo Park', '$180'],
                ['Palo Alto', '$275'],
                [''],
                ['Parking Locations'],
                ['Name', 'Location', 'Rate/mo', 'Spaces']
            ];

            parkingLocations.forEach(p => {
                csv.push([p.name, `${p.coords[0]}, ${p.coords[1]}`, `$${p.rate}`, p.spaces]);
            });

            csv.push(['']);
            csv.push(['Tech Companies']);
            csv.push(['Company', 'Employees']);

            companies.forEach(c => {
                csv.push([c.name, c.employees]);
            });

            csv.push(['']);
            csv.push(['Transit Summary']);
            csv.push(['Caltrain Stations', caltrainStations.length]);
            csv.push(['BART Lines', '5']);
            csv.push(['VTA Stations', vtaStations.length]);
            csv.push(['Total AI Talent Pool', '95,000+']);

            const csvContent = csv.map(row => row.join(',')).join('\n');
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'odyssey-map-data.csv';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        console.log('üéâ Map fully loaded with Commute Simulator!');
    

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CUSTOM ADDRESS FEATURE - Google Maps Integration
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

const GOOGLE_MAPS_API_KEY = 'AIzaSyD1w0vlNjrD3_19U-CUWYQNiPcQBBTaPus';

// Destination offices with full addresses
const OFFICE_LOCATIONS = {
    'Property1': {
        name: '201 Baldwin Ave',
        address: '201 Baldwin Ave, San Mateo, CA 94401',
        coords: { lat: 37.5636, lng: -122.3228 },
        parking: 'Dedicated parking lot',
        city: 'San Mateo'
    },
    'Property2': {
        name: '2 E 3rd Ave',
        address: '2 E 3rd Ave, San Mateo, CA 94401',
        coords: { lat: 37.5636, lng: -122.3248 },
        parking: '',
        city: 'San Mateo'
    },
    'Property3': {
        name: '2317 Broadway',
        address: '2317 Broadway, Redwood City, CA 94063',
        coords: { lat: 37.4863, lng: -122.2325 },
        parking: 'Public parking, $60/mo per employee',
        city: 'Redwood City',
        isPaid: true
    },
    'Property4': {
        name: '900 Veterans Blvd',
        address: '900 Veterans Blvd, Redwood City, CA 94063',
        coords: { lat: 37.4920, lng: -122.2280 },
        parking: 'Bay Area Bank Building - Dedicated parking',
        city: 'Redwood City'
    },
    'Property5': {
        name: '181 2nd Ave',
        address: '181 2nd Ave, San Mateo, CA 94401',
        coords: { lat: 37.5645, lng: -122.3235 },
        parking: 'San Mateo Business Center - Dedicated parking',
        city: 'San Mateo'
    },
    'Property6': {
        name: '1 Franklin Parkway',
        address: '1 Franklin Parkway, San Mateo, CA 94403',
        coords: { lat: 37.5500, lng: -122.3000 },
        parking: '910 Park - Dedicated parking',
        city: 'San Mateo'
    }
};

// Executive pre-set addresses
const EXEC_ADDRESSES = {
    'Pacific Heights': {
        address: '2200 Pacific Ave, San Francisco, CA 94115',
        name: 'Pacific Heights, SF'
    },
    'Oakland': {
        address: '401 14th St, Oakland, CA 94612',
        name: 'Oakland Downtown'
    },
    'Oliver (San Jose)': {
        address: '2365 Homewood Drive, San Jose, CA 95128',
        name: 'San Jose (Oliver)'
    }
};

// Initialize Google Maps API
function initializeGoogleMapsAPI() {
    return new Promise((resolve, reject) => {
        if (window.google && window.google.maps) {
            resolve();
            return;
        }

        const script = document.createElement('script');
        script.src = `https://maps.googleapis.com/maps/api/js?key=${GOOGLE_MAPS_API_KEY}&libraries=places`;
        script.async = true;
        script.defer = true;
        script.onload = () => {
            console.log('‚úÖ Google Maps API loaded');
            resolve();
        };
        script.onerror = () => {
            console.error('‚ùå Failed to load Google Maps API');
            reject(new Error('Failed to load Google Maps API'));
        };
        document.head.appendChild(script);
    });
}

// Calculate commute times using Google Distance Matrix API
async function calculateCustomCommuteTimes(originAddress) {
    const loadingEl = document.getElementById('loading-indicator');
    const resultsEl = document.getElementById('custom-results');
    
    loadingEl.classList.add('active');
    resultsEl.classList.remove('active');

    try {
        // Ensure Google Maps is loaded
        if (!window.google || !window.google.maps) {
            await initializeGoogleMapsAPI();
        }

        const service = new google.maps.DistanceMatrixService();
        const destinations = Object.values(OFFICE_LOCATIONS).map(office => office.address);

        // Request driving times
        const response = await new Promise((resolve, reject) => {
            service.getDistanceMatrix({
                origins: [originAddress],
                destinations: destinations,
                travelMode: 'DRIVING',
                drivingOptions: {
                    departureTime: new Date(Date.now() + 24 * 60 * 60 * 1000), // Tomorrow at same time
                    trafficModel: 'bestguess'
                },
                unitSystem: google.maps.UnitSystem.IMPERIAL
            }, (response, status) => {
                if (status === 'OK') {
                    resolve(response);
                } else {
                    reject(new Error(`Distance Matrix failed: ${status}`));
                }
            });
        });

        // Parse results
        const results = {};
        const elements = response.rows[0].elements;
        const officeKeys = Object.keys(OFFICE_LOCATIONS);

        officeKeys.forEach((key, index) => {
            const element = elements[index];
            if (element.status === 'OK') {
                results[key] = {
                    ...OFFICE_LOCATIONS[key],
                    duration: Math.ceil(element.duration_in_traffic ? element.duration_in_traffic.value / 60 : element.duration.value / 60),
                    distance: element.distance.text
                };
            }
        });

        // Display results
        displayCustomResults(results, originAddress);

    } catch (error) {
        console.error('Error calculating commute:', error);
        alert('Unable to calculate commute times. Please check the address and try again.');
    } finally {
        loadingEl.classList.remove('active');
    }
}

// Display custom address results
function displayCustomResults(results, originAddress) {
    const resultsEl = document.getElementById('custom-results');
    
    let html = `<div style="margin-bottom: 12px; padding: 10px; background: white; border-radius: 8px;">
        <div style="font-size: 11px; color: #86868b; margin-bottom: 4px;">FROM</div>
        <div style="font-size: 13px; font-weight: 600; color: #1d1d1f;">üìç ${originAddress}</div>
    </div>`;

    Object.entries(results).forEach(([key, office]) => {
        html += `
            <div class="result-destination">
                <div class="dest-name">üéØ ${office.name}</div>
                <div class="dest-address">${office.address}</div>
                <div class="dest-times">
                    <div class="time-item">
                        <div class="time-label">Drive Time</div>
                        <div class="time-value">${office.duration} min</div>
                    </div>
                    <div class="time-item">
                        <div class="time-label">Distance</div>
                        <div class="time-value">${office.distance}</div>
                    </div>
                </div>
                ${office.parking ? `<div class="parking-badge ${office.isPaid ? 'parking-paid' : 'parking-free'}">üÖøÔ∏è ${office.parking}</div>` : ''}
            </div>
        `;
    });

    // Add transit recommendation
    const avgTime = Object.values(results).reduce((sum, r) => sum + r.duration, 0) / Object.values(results).length;
    let transitRec = '';
    
    if (originAddress.toLowerCase().includes('san francisco') || originAddress.toLowerCase().includes('sf')) {
        transitRec = 'üöÜ Caltrain from 4th & King (Express trains: 7:15am, 7:37am, 8:06am)';
    } else if (originAddress.toLowerCase().includes('oakland')) {
        transitRec = 'üöÜ BART to Millbrae ‚Üí Caltrain (Red Line ‚Üí Caltrain)';
    } else if (originAddress.toLowerCase().includes('san jose')) {
        transitRec = 'üöÜ Caltrain from San Jose Diridon (Express trains: 6:42am, 7:12am, 7:42am)';
    } else {
        transitRec = avgTime < 30 ? 'üöó Driving recommended (close proximity)' : 'üöÜ Consider Caltrain or carpool';
    }

    html += `
        <div style="margin-top: 12px; padding: 12px; background: white; border-radius: 8px;">
            <div style="font-size: 11px; color: #86868b; margin-bottom: 6px; text-transform: uppercase; letter-spacing: 0.5px;">Recommended Route</div>
            <div style="font-size: 13px; font-weight: 600; color: #1d1d1f;">${transitRec}</div>
        </div>
    `;

    resultsEl.innerHTML = html;
    resultsEl.classList.add('active');
}

// Initialize autocomplete for custom address input
function initializeAutocomplete() {
    const input = document.getElementById('custom-address');
    
    if (!window.google || !window.google.maps) {
        console.warn('Google Maps not loaded yet, will initialize later');
        return;
    }

    const autocomplete = new google.maps.places.Autocomplete(input, {
        bounds: new google.maps.LatLngBounds(
            new google.maps.LatLng(37.0, -122.5),
            new google.maps.LatLng(38.0, -121.5)
        ),
        componentRestrictions: { country: 'us' },
        fields: ['formatted_address', 'geometry']
    });

    autocomplete.addListener('place_changed', () => {
        const place = autocomplete.getPlace();
        if (place.formatted_address) {
            input.value = place.formatted_address;
        }
    });

    console.log('‚úÖ Autocomplete initialized');
}

// Initialize all event listeners
function initializeCustomAddressFeature() {
    // Executive quick-select buttons
    document.querySelectorAll('.exec-btn').forEach(btn => {
        btn.addEventListener('click', () => {
            const execKey = btn.dataset.exec;
            const execData = EXEC_ADDRESSES[execKey];
            document.getElementById('custom-address').value = execData.address;
            calculateCustomCommuteTimes(execData.address);
        });
    });

    // Calculate button
    document.getElementById('calculate-commute').addEventListener('click', () => {
        const address = document.getElementById('custom-address').value.trim();
        if (address) {
            calculateCustomCommuteTimes(address);
        } else {
            alert('Please enter an address');
        }
    });

    // Enter key support
    document.getElementById('custom-address').addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
            const address = e.target.value.trim();
            if (address) {
                calculateCustomCommuteTimes(address);
            }
        }
    });

    // Load Google Maps and initialize autocomplete
    initializeGoogleMapsAPI().then(() => {
        initializeAutocomplete();
    }).catch(err => {
        console.error('Failed to initialize Google Maps:', err);
    });

    console.log('‚úÖ Custom address feature initialized');
}

// Export for use in main HTML
if (typeof module !== 'undefined' && module.exports) {
    module.exports = { initializeCustomAddressFeature };
}




        // Initialize custom address feature
        initializeCustomAddressFeature();

</script>
</body>
</html>
