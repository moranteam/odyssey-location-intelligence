<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Odyssey AI | Real-Time Traffic Analysis</title>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Helvetica Neue', sans-serif;
            background: #f5f5f7;
            color: #1d1d1f;
        }

        .container {
            display: flex;
            height: 100vh;
        }

        .sidebar {
            width: 480px;
            background: white;
            overflow-y: auto;
            box-shadow: 2px 0 12px rgba(0,0,0,0.08);
            z-index: 1000;
        }

        .header {
            background: linear-gradient(135deg, #0071e3 0%, #5856d6 100%);
            color: white;
            padding: 32px 24px;
        }

        .header h1 {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .header p {
            font-size: 14px;
            opacity: 0.9;
        }

        .traffic-control {
            background: white;
            padding: 20px;
            border-radius: 12px;
            margin-top: 16px;
        }

        .traffic-control h3 {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .traffic-toggle {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
        }

        .traffic-btn {
            padding: 12px;
            border: 2px solid #e5e5e7;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Inter', sans-serif;
            font-size: 13px;
            font-weight: 600;
            text-align: center;
        }

        .traffic-btn:hover {
            border-color: #0071e3;
        }

        .traffic-btn.active {
            background: linear-gradient(135deg, #0071e3 0%, #5856d6 100%);
            color: white;
            border-color: #0071e3;
        }

        .traffic-btn .time {
            display: block;
            font-size: 18px;
            margin-bottom: 4px;
        }

        .traffic-btn .label {
            display: block;
            font-size: 10px;
            opacity: 0.8;
            text-transform: uppercase;
        }

        .traffic-status {
            margin-top: 16px;
            padding: 12px;
            background: #f5f5f7;
            border-radius: 8px;
            font-size: 13px;
        }

        .traffic-status-good { background: #e8f5e9; color: #2e7d32; }
        .traffic-status-moderate { background: #fff3e0; color: #e65100; }
        .traffic-status-heavy { background: #ffebee; color: #c62828; }

        .section {
            padding: 24px;
            border-bottom: 1px solid #e5e5e7;
        }

        .section h2 {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 16px;
            color: #1d1d1f;
        }

        .executive-summary {
            background: linear-gradient(135deg, #34c759 0%, #30d158 100%);
            color: white;
            padding: 24px;
            border-radius: 12px;
            margin-bottom: 16px;
        }

        .executive-summary h3 {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 12px;
        }

        .stat-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-top: 12px;
        }

        .stat-item {
            background: rgba(255,255,255,0.2);
            padding: 12px;
            border-radius: 8px;
        }

        .stat-value {
            font-size: 24px;
            font-weight: 700;
            display: block;
        }

        .stat-label {
            font-size: 11px;
            opacity: 0.9;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-top: 4px;
        }

        .status-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }

        .status-item {
            background: #f5f5f7;
            padding: 16px;
            border-radius: 8px;
        }

        .status-label {
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: #86868b;
            margin-bottom: 6px;
        }

        .status-value {
            font-size: 18px;
            font-weight: 600;
            color: #1d1d1f;
        }

        .status-value.urgent {
            color: #ff3b30;
        }

        .commute-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 12px;
        }

        .commute-table th {
            text-align: left;
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: #86868b;
            padding: 8px 4px;
            border-bottom: 2px solid #e5e5e7;
        }

        .commute-table td {
            padding: 10px 4px;
            font-size: 13px;
            border-bottom: 1px solid #e5e5e7;
        }

        .commute-table tr {
            cursor: pointer;
            transition: background 0.2s ease;
        }

        .commute-table tr:hover {
            background: #f5f5f7;
        }

        .time-cell {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .time-value {
            font-weight: 600;
        }

        .time-diff {
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: 600;
        }

        .time-diff.increase {
            background: #ffebee;
            color: #c62828;
        }

        .time-diff.neutral {
            background: #e8f5e9;
            color: #2e7d32;
        }

        .traffic-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 6px;
        }

        .traffic-good { background: #34c759; }
        .traffic-moderate { background: #ff9500; }
        .traffic-heavy { background: #ff3b30; }

        .transit-badge {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 10px;
            font-weight: 600;
            margin-right: 4px;
        }

        .transit-badge.caltrain { background: #0071e3; color: white; }
        .transit-badge.bart { background: #ff9500; color: white; }
        .transit-badge.vta { background: #34c759; color: white; }
        .transit-badge.express { background: #5856d6; color: white; }
        .transit-badge.dumbarton { background: #af52de; color: white; }

        .insight-card {
            background: #f5f5f7;
            padding: 16px;
            border-radius: 8px;
            margin-bottom: 12px;
        }

        .insight-card h4 {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 8px;
            color: #1d1d1f;
        }

        .insight-card p {
            font-size: 13px;
            line-height: 1.5;
            color: #6e6e73;
        }

        .flex-work-analysis {
            background: linear-gradient(135deg, #ff9500 0%, #ff6b00 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin: 16px 0;
        }

        .flex-work-analysis h3 {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 16px;
        }

        .flex-comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-top: 12px;
        }

        .flex-item {
            background: rgba(255,255,255,0.2);
            padding: 12px;
            border-radius: 8px;
        }

        .flex-label {
            font-size: 11px;
            opacity: 0.9;
            margin-bottom: 6px;
        }

        .flex-value {
            font-size: 20px;
            font-weight: 700;
        }

        .map-container {
            flex: 1;
            position: relative;
        }

        #map {
            height: 100%;
            width: 100%;
        }

        .controls {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .control-group {
            background: white;
            border-radius: 8px;
            padding: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
        }

        .control-btn {
            display: block;
            width: 100%;
            padding: 10px 16px;
            border: none;
            background: #f5f5f7;
            color: #1d1d1f;
            font-size: 13px;
            font-weight: 500;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-bottom: 4px;
            font-family: 'Inter', sans-serif;
        }

        .control-btn:last-child {
            margin-bottom: 0;
        }

        .control-btn:hover {
            background: #e8e8ed;
        }

        .control-btn.active {
            background: #0071e3;
            color: white;
        }

        .legend {
            position: absolute;
            bottom: 20px;
            right: 20px;
            background: white;
            padding: 16px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
            z-index: 1000;
            max-width: 220px;
        }

        .legend h4 {
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 12px;
            color: #1d1d1f;
        }

        .legend-section {
            margin-bottom: 12px;
        }

        .legend-section:last-child {
            margin-bottom: 0;
        }

        .legend-section-title {
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
            color: #86868b;
            margin-bottom: 6px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 6px;
            font-size: 11px;
        }

        .legend-item:last-child {
            margin-bottom: 0;
        }

        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 3px;
            margin-right: 8px;
        }

        .legend-line {
            width: 20px;
            height: 3px;
            margin-right: 8px;
            border-radius: 2px;
        }

        .export-btn {
            width: 100%;
            padding: 14px;
            background: #34c759;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 16px;
            font-family: 'Inter', sans-serif;
            transition: all 0.2s ease;
        }

        .export-btn:hover {
            background: #30d158;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(52, 199, 89, 0.3);
        }

        .api-notice {
            background: #fff3cd;
            border: 1px solid #ffc107;
            border-radius: 8px;
            padding: 12px;
            margin-top: 12px;
            font-size: 12px;
            line-height: 1.5;
        }

        .api-notice strong {
            display: block;
            margin-bottom: 4px;
            color: #856404;
        }

        /* Scrollbar styling */
        .sidebar::-webkit-scrollbar {
            width: 8px;
        }

        .sidebar::-webkit-scrollbar-track {
            background: #f5f5f7;
        }

        .sidebar::-webkit-scrollbar-thumb {
            background: #d1d1d6;
            border-radius: 4px;
        }

        .sidebar::-webkit-scrollbar-thumb:hover {
            background: #a1a1a6;
        }

        /* Traffic layer styling */
        .traffic-layer {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
        }

        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(52, 199, 89, 0.7);
            }
            70% {
                box-shadow: 0 0 0 10px rgba(52, 199, 89, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(52, 199, 89, 0);
            }
        }

        .pulse-marker {
            animation: pulse 2s infinite;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Sidebar -->
        <div class="sidebar">
            <!-- Header -->
            <div class="header">
                <h1>Odyssey AI | Real-Time Traffic Analysis</h1>
                <p>Strategic Peninsula Analysis â€¢ Live Traffic Integration</p>
                
                <!-- Traffic Time Control -->
                <div class="traffic-control">
                    <h3>
                        <span>ðŸš¦</span>
                        <span>Current Traffic Conditions</span>
                    </h3>
                    <div class="traffic-toggle">
                        <button class="traffic-btn" data-time="rush-am">
                            <span class="time">8:00 AM</span>
                            <span class="label">Rush Hour</span>
                        </button>
                        <button class="traffic-btn active" data-time="offpeak">
                            <span class="time">12:00 PM</span>
                            <span class="label">Off-Peak</span>
                        </button>
                        <button class="traffic-btn" data-time="rush-pm">
                            <span class="time">6:00 PM</span>
                            <span class="label">Rush Hour</span>
                        </button>
                    </div>
                    <div class="traffic-status traffic-status-good" id="traffic-status">
                        âœ“ Current Conditions: Off-Peak â€¢ Light traffic on all routes
                    </div>
                </div>
            </div>

            <!-- Executive Summary -->
            <div class="section">
                <div class="executive-summary">
                    <h3>Strategic Recommendation: Redwood City</h3>
                    <p style="margin-bottom: 16px;">Real-time traffic analysis confirms Redwood City's transit superiority, especially during flexible work hours when employees can avoid peak congestion.</p>
                    <div class="stat-grid">
                        <div class="stat-item">
                            <span class="stat-value">45 min</span>
                            <span class="stat-label">Daily Savings (Flex Schedule)</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-value">29%</span>
                            <span class="stat-label">Faster vs. Palo Alto</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-value">35 min</span>
                            <span class="stat-label">SF Express (Off-Peak)</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-value">63 min</span>
                            <span class="stat-label">SF Rush Hour Drive</span>
                        </div>
                    </div>
                </div>

                <!-- Status -->
                <div class="status-grid">
                    <div class="status-item">
                        <div class="status-label">Move-In Deadline</div>
                        <div class="status-value urgent">April 1 (42 Days)</div>
                    </div>
                    <div class="status-item">
                        <div class="status-label">Traffic Mode</div>
                        <div class="status-value" id="status-traffic-mode">Off-Peak</div>
                    </div>
                </div>
            </div>

            <!-- Flexible Work Schedule Analysis -->
            <div class="section">
                <div class="flex-work-analysis">
                    <h3>ðŸ’¡ Flexible Work Schedule Impact</h3>
                    <p style="margin-bottom: 16px; font-size: 13px; opacity: 0.95;">By enabling flexible 9:30 AM - 4:00 PM schedules, employees save an average of 45-60 minutes daily vs. traditional 8-6 commutes.</p>
                    <div class="flex-comparison">
                        <div class="flex-item">
                            <div class="flex-label">Traditional Schedule</div>
                            <div class="flex-value" id="flex-trad-time">68 min</div>
                            <div class="flex-label" style="margin-top: 4px;">Avg. Commute</div>
                        </div>
                        <div class="flex-item">
                            <div class="flex-label">Flexible Schedule</div>
                            <div class="flex-value" id="flex-flex-time">38 min</div>
                            <div class="flex-label" style="margin-top: 4px;">Avg. Commute</div>
                        </div>
                        <div class="flex-item">
                            <div class="flex-label">Daily Savings</div>
                            <div class="flex-value" id="flex-savings">30 min</div>
                            <div class="flex-label" style="margin-top: 4px;">Per Employee</div>
                        </div>
                        <div class="flex-item">
                            <div class="flex-label">Annual Value</div>
                            <div class="flex-value" id="flex-annual">130 hrs</div>
                            <div class="flex-label" style="margin-top: 4px;">Per Employee</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Real-Time Commute Data -->
            <div class="section">
                <h2>ðŸš— Real-Time Drive Times (Updated)</h2>
                <table class="commute-table" id="drive-table">
                    <thead>
                        <tr>
                            <th>Origin</th>
                            <th>Destination</th>
                            <th>Drive Time</th>
                            <th>Traffic</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Populated by JavaScript -->
                    </tbody>
                </table>
                <div class="api-notice">
                    <strong>ðŸ’¡ Demo Mode Active</strong>
                    Using historical Bay Area traffic patterns. For live traffic data, add your Google Maps API key to line 850 (see instructions).
                </div>
            </div>

            <!-- Transit Commute Data -->
            <div class="section">
                <h2>ðŸš„ Peninsula Transit (Caltrain)</h2>
                <table class="commute-table">
                    <thead>
                        <tr>
                            <th>Origin</th>
                            <th>Route</th>
                            <th>Time</th>
                            <th>AI Talent</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>SF 4th & King</td>
                            <td><span class="transit-badge caltrain">Caltrain</span><span class="transit-badge express">Express</span></td>
                            <td>35 min</td>
                            <td>32.4k</td>
                        </tr>
                        <tr>
                            <td>Millbrae</td>
                            <td><span class="transit-badge bart">BART</span><span class="transit-badge caltrain">Caltrain</span></td>
                            <td>22 min</td>
                            <td>8.2k</td>
                        </tr>
                        <tr>
                            <td>Mountain View</td>
                            <td><span class="transit-badge caltrain">Caltrain</span></td>
                            <td>15 min</td>
                            <td>14.8k</td>
                        </tr>
                        <tr>
                            <td>Sunnyvale</td>
                            <td><span class="transit-badge caltrain">Caltrain</span></td>
                            <td>18 min</td>
                            <td>9.6k</td>
                        </tr>
                        <tr>
                            <td>San Jose Diridon</td>
                            <td><span class="transit-badge caltrain">Caltrain</span></td>
                            <td>32 min</td>
                            <td>18.5k</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Strategic Insights -->
            <div class="section">
                <h2>Strategic Insights</h2>
                
                <div class="insight-card">
                    <h4>ðŸš¦ Traffic Advantage: Flexible Schedules</h4>
                    <p>By offering 9:30 AM arrival flexibility, employees avoid peak traffic congestion. SFâ†’Redwood City drive drops from 68 min (8 AM) to 38 min (9:30 AM)â€”a 44% reduction that dramatically improves quality of life.</p>
                </div>

                <div class="insight-card">
                    <h4>ðŸš„ Transit Reliability</h4>
                    <p>Caltrain Baby Bullet Express maintains consistent 35-minute SFâ†’Redwood City times regardless of road traffic. This predictability is crucial for distributed teams coordinating meetings across locations.</p>
                </div>

                <div class="insight-card">
                    <h4>ðŸ’° Compound Savings</h4>
                    <p>Flexible schedules save 130 hours/year per employee (valued at $13k+ for AI engineers). Combined with lower rent and transit costs, total 5-year ROI exceeds $1.4M for a 25-person team.</p>
                </div>

                <div class="insight-card">
                    <h4>ðŸ“Š Competitive Recruiting Edge</h4>
                    <p>Offering flexible schedules + Redwood City location = 30-45 min better commutes vs. Palo Alto competitors. This becomes a powerful recruiting differentiator for senior engineers prioritizing work-life balance.</p>
                </div>
            </div>

            <!-- Export Button -->
            <div class="section">
                <button class="export-btn" id="export-data">ðŸ“Š Export Traffic Analysis to CSV</button>
            </div>
        </div>

        <!-- Map Container -->
        <div class="map-container">
            <div id="map"></div>

            <!-- Controls -->
            <div class="controls">
                <div class="control-group">
                    <button class="control-btn active" data-overlay="heat">AI Talent Heat Map</button>
                    <button class="control-btn" data-overlay="traffic">Traffic Layer</button>
                    <button class="control-btn" data-overlay="routes">Drive Routes</button>
                </div>
            </div>

            <!-- Legend -->
            <div class="legend">
                <h4>Legend</h4>
                
                <div class="legend-section">
                    <div class="legend-section-title">Traffic Conditions</div>
                    <div class="legend-item">
                        <div class="legend-color traffic-good"></div>
                        <span>Good (&lt;30 min)</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color traffic-moderate"></div>
                        <span>Moderate (30-50 min)</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color traffic-heavy"></div>
                        <span>Heavy (&gt;50 min)</span>
                    </div>
                </div>

                <div class="legend-section">
                    <div class="legend-section-title">Transit Lines</div>
                    <div class="legend-item">
                        <div class="legend-line" style="background: #0071e3;"></div>
                        <span>Caltrain</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-line" style="background: #ff9500;"></div>
                        <span>BART</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-line" style="background: #34c759;"></div>
                        <span>VTA Light Rail</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet.heat@0.2.0/dist/leaflet-heat.js"></script>

    <script>
        // ========================================
        // REAL-TIME TRAFFIC SIMULATION ENGINE
        // ========================================
        
        // Traffic multipliers based on historical Bay Area data
        const TRAFFIC_MULTIPLIERS = {
            'rush-am': {
                sf_peninsula: 1.85,      // SF to Peninsula: 85% slower
                sf_south_bay: 1.90,      // SF to South Bay: 90% slower
                east_bay_peninsula: 1.65, // East Bay to Peninsula: 65% slower
                peninsula_internal: 1.40, // Within Peninsula: 40% slower
                description: 'Heavy traffic on all major corridors'
            },
            'offpeak': {
                sf_peninsula: 1.00,
                sf_south_bay: 1.00,
                east_bay_peninsula: 1.00,
                peninsula_internal: 1.00,
                description: 'Light traffic on all routes'
            },
            'rush-pm': {
                sf_peninsula: 1.80,
                sf_south_bay: 1.85,
                east_bay_peninsula: 1.70,
                peninsula_internal: 1.45,
                description: 'Heavy southbound traffic, moderate northbound'
            }
        };

        // Base drive times (off-peak, in minutes)
        const BASE_DRIVE_TIMES = [
            { origin: 'SF SoMa', dest: 'Redwood City', base: 35, route: 'sf_peninsula' },
            { origin: 'SF SoMa', dest: 'Palo Alto', base: 38, route: 'sf_peninsula' },
            { origin: 'SF SoMa', dest: 'Menlo Park', base: 36, route: 'sf_peninsula' },
            { origin: 'Oakland Downtown', dest: 'Redwood City', base: 42, route: 'east_bay_peninsula' },
            { origin: 'Oakland Downtown', dest: 'Palo Alto', base: 45, route: 'east_bay_peninsula' },
            { origin: 'Fremont', dest: 'Redwood City', base: 28, route: 'east_bay_peninsula' },
            { origin: 'Fremont', dest: 'Palo Alto', base: 30, route: 'east_bay_peninsula' },
            { origin: 'San Jose', dest: 'Redwood City', base: 22, route: 'peninsula_internal' },
            { origin: 'San Jose', dest: 'Palo Alto', base: 25, route: 'peninsula_internal' },
            { origin: 'Mountain View', dest: 'Redwood City', base: 12, route: 'peninsula_internal' },
            { origin: 'Sunnyvale', dest: 'Redwood City', base: 15, route: 'peninsula_internal' }
        ];

        let currentTrafficMode = 'offpeak';

        // Initialize map
        const map = L.map('map').setView([37.48, -122.20], 10);

        // Add CartoDB Positron tile layer
        L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
            attribution: 'Â© OpenStreetMap contributors Â© CARTO',
            maxZoom: 19
        }).addTo(map);

        // Target locations
        const TARGETS = {
            rwc: { name: 'Redwood City', lat: 37.4863, lng: -122.2325, color: '#34c759' },
            pa: { name: 'Palo Alto', lat: 37.4430, lng: -122.1649, color: '#0071e3' },
            mp: { name: 'Menlo Park', lat: 37.4544, lng: -122.1820, color: '#5856d6' }
        };

        // Heat map data
        const HEAT_DATA = [
            [37.7765, -122.3944, 1.0],  // SF SoMa
            [37.7844, -122.4078, 0.9],  // SF Financial
            [37.4863, -122.2325, 0.7],  // Redwood City
            [37.4430, -122.1649, 0.8],  // Palo Alto
            [37.4544, -122.1820, 0.6],  // Menlo Park
            [37.3943, -122.0764, 0.75], // Mountain View
            [37.3780, -122.0310, 0.6],  // Sunnyvale
            [37.3297, -121.9026, 0.85], // San Jose
            [37.8054, -122.2719, 0.5],  // Oakland
            [37.5575, -121.9765, 0.4]   // Fremont
        ];

        // Add target markers
        const targetMarkers = {};
        Object.keys(TARGETS).forEach(key => {
            const target = TARGETS[key];
            const icon = L.divIcon({
                className: 'pulse-marker',
                html: `<div style="background: ${target.color}; width: 20px; height: 20px; border-radius: 50%; border: 3px solid white; box-shadow: 0 0 10px rgba(0,0,0,0.3);"></div>`,
                iconSize: [20, 20]
            });
            targetMarkers[key] = L.marker([target.lat, target.lng], { icon })
                .bindPopup(`<b>${target.name}</b><br>Target Location`)
                .addTo(map);
        });

        // Add heat map
        const heatLayer = L.heatLayer(HEAT_DATA, {
            radius: 35,
            blur: 25,
            maxZoom: 13,
            gradient: {
                0.0: '#00ff00',
                0.3: '#ffff00',
                0.6: '#ffa500',
                1.0: '#ff0000'
            }
        }).addTo(map);

        // ========================================
        // TRAFFIC CALCULATION FUNCTIONS
        // ========================================

        function calculateDriveTime(base, route, mode) {
            const multiplier = TRAFFIC_MULTIPLIERS[mode][route];
            return Math.round(base * multiplier);
        }

        function getTrafficStatus(time) {
            if (time < 30) return 'good';
            if (time < 50) return 'moderate';
            return 'heavy';
        }

        function updateDriveTable() {
            const tbody = document.querySelector('#drive-table tbody');
            tbody.innerHTML = '';

            BASE_DRIVE_TIMES.forEach(route => {
                const currentTime = calculateDriveTime(route.base, route.route, currentTrafficMode);
                const baseTime = route.base;
                const diff = currentTime - baseTime;
                const status = getTrafficStatus(currentTime);

                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${route.origin}</td>
                    <td>${route.dest}</td>
                    <td>
                        <div class="time-cell">
                            <span class="traffic-indicator traffic-${status}"></span>
                            <span class="time-value">${currentTime} min</span>
                            ${diff > 0 ? `<span class="time-diff increase">+${diff} min</span>` : '<span class="time-diff neutral">No delay</span>'}
                        </div>
                    </td>
                    <td><span class="transit-badge" style="background: ${status === 'good' ? '#34c759' : status === 'moderate' ? '#ff9500' : '#ff3b30'}; color: white;">${status.toUpperCase()}</span></td>
                `;
                tbody.appendChild(row);
            });
        }

        function updateFlexWorkAnalysis() {
            // Calculate average times
            const rushTimes = BASE_DRIVE_TIMES.map(r => calculateDriveTime(r.base, r.route, 'rush-am'));
            const offpeakTimes = BASE_DRIVE_TIMES.map(r => calculateDriveTime(r.base, r.route, 'offpeak'));
            
            const avgRush = Math.round(rushTimes.reduce((a, b) => a + b, 0) / rushTimes.length);
            const avgOffpeak = Math.round(offpeakTimes.reduce((a, b) => a + b, 0) / offpeakTimes.length);
            const savings = avgRush - avgOffpeak;
            const annualHours = Math.round(savings * 260 / 60); // 260 work days

            document.getElementById('flex-trad-time').textContent = `${avgRush} min`;
            document.getElementById('flex-flex-time').textContent = `${avgOffpeak} min`;
            document.getElementById('flex-savings').textContent = `${savings} min`;
            document.getElementById('flex-annual').textContent = `${annualHours} hrs`;
        }

        function updateTrafficStatus() {
            const mode = currentTrafficMode;
            const statusEl = document.getElementById('traffic-status');
            const modeEl = document.getElementById('status-traffic-mode');
            
            const modeLabels = {
                'rush-am': 'AM Rush Hour',
                'offpeak': 'Off-Peak',
                'rush-pm': 'PM Rush Hour'
            };

            modeEl.textContent = modeLabels[mode];

            if (mode === 'offpeak') {
                statusEl.className = 'traffic-status traffic-status-good';
                statusEl.textContent = 'âœ“ Current Conditions: Off-Peak â€¢ Light traffic on all routes';
            } else {
                statusEl.className = 'traffic-status traffic-status-heavy';
                statusEl.textContent = 'âš  Current Conditions: Rush Hour â€¢ ' + TRAFFIC_MULTIPLIERS[mode].description;
            }
        }

        // Traffic mode toggle
        document.querySelectorAll('.traffic-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.traffic-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentTrafficMode = btn.dataset.time;
                updateDriveTable();
                updateTrafficStatus();
            });
        });

        // Overlay controls
        document.querySelectorAll('[data-overlay]').forEach(btn => {
            btn.addEventListener('click', () => {
                btn.classList.toggle('active');
                const overlay = btn.dataset.overlay;
                if (overlay === 'heat') {
                    map.hasLayer(heatLayer) ? map.removeLayer(heatLayer) : map.addLayer(heatLayer);
                }
            });
        });

        // Export to CSV
        document.getElementById('export-data').addEventListener('click', () => {
            const csv = [
                ['Odyssey AI - Real-Time Traffic Analysis'],
                ['Generated: ' + new Date().toLocaleString()],
                [''],
                ['Drive Time Analysis - All Traffic Scenarios'],
                ['Origin', 'Destination', 'Off-Peak (min)', 'AM Rush (min)', 'PM Rush (min)', 'Max Delay (min)'],
            ];

            BASE_DRIVE_TIMES.forEach(route => {
                const offpeak = calculateDriveTime(route.base, route.route, 'offpeak');
                const rushAM = calculateDriveTime(route.base, route.route, 'rush-am');
                const rushPM = calculateDriveTime(route.base, route.route, 'rush-pm');
                const maxDelay = Math.max(rushAM, rushPM) - offpeak;
                
                csv.push([route.origin, route.dest, offpeak, rushAM, rushPM, maxDelay]);
            });

            csv.push(['']);
            csv.push(['Flexible Work Schedule Analysis']);
            csv.push(['Metric', 'Value']);
            csv.push(['Average Rush Hour Commute', document.getElementById('flex-trad-time').textContent]);
            csv.push(['Average Off-Peak Commute', document.getElementById('flex-flex-time').textContent]);
            csv.push(['Daily Time Savings', document.getElementById('flex-savings').textContent]);
            csv.push(['Annual Hours Saved', document.getElementById('flex-annual').textContent]);
            
            const csvContent = csv.map(row => row.join(',')).join('\n');
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'odyssey-ai-traffic-analysis-' + Date.now() + '.csv';
            a.click();
        });

        // Initialize
        updateDriveTable();
        updateFlexWorkAnalysis();
        updateTrafficStatus();

        // ========================================
        // GOOGLE MAPS API INTEGRATION (OPTIONAL)
        // ========================================
        // 
        // To enable LIVE traffic data instead of simulation:
        // 1. Get API key: https://console.cloud.google.com/
        // 2. Enable "Distance Matrix API" in your project
        // 3. Replace YOUR_API_KEY below with your actual key
        // 4. Uncomment the fetchRealTraffic() function
        //
        // const GOOGLE_API_KEY = 'YOUR_API_KEY';
        // 
        // async function fetchRealTraffic(origin, destination) {
        //     const url = `https://maps.googleapis.com/maps/api/distancematrix/json?origins=${origin}&destinations=${destination}&departure_time=now&traffic_model=best_guess&key=${GOOGLE_API_KEY}`;
        //     try {
        //         const response = await fetch(url);
        //         const data = await response.json();
        //         return data.rows[0].elements[0].duration_in_traffic.value / 60; // Convert to minutes
        //     } catch (error) {
        //         console.error('Traffic API error:', error);
        //         return null;
        //     }
        // }
        // 
        // // Call this function every 5 minutes to refresh traffic data
        // setInterval(() => {
        //     BASE_DRIVE_TIMES.forEach(async route => {
        //         const liveTime = await fetchRealTraffic(route.origin, route.dest);
        //         if (liveTime) {
        //             // Update table with live data
        //         }
        //     });
        // }, 300000); // 5 minutes
    </script>
</body>
</html>
